<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client List</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --danger: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        input#searchBar { padding: 10px; width: 250px; border: 1px solid #ddd; border-radius: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: var(--primary); }
        tr:hover { background: #fdfdfd; }
        
        .btn-del { background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
        .loader { text-align: center; padding: 20px; font-weight: bold; color: var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <div class="header-flex">
        <h2>ðŸ“‹ Client Directory</h2>
        <input type="text" id="searchBar" onkeyup="filterTable()" placeholder="Search by name or phone...">
    </div>

    <div id="loader" class="loader">Fetching clients...</div>
    
    <table id="clientTable" class="hidden">
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Address</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="clientBody"></tbody>
    </table>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwKgib802NVM4Mn31in9KhfoMHPA9b2tubCMLq7lDrCmthRNyryOiPaAT5FBrnL_qto/exec";

    async function loadClients() {
        const user = JSON.parse(localStorage.getItem("user"));
        try {
            const response = await fetch(`${API_URL}?action=getClients&userId=${user.id}`);
            const clients = await response.json();
            
            const tbody = document.getElementById("clientBody");
            tbody.innerHTML = "";
            
            clients.forEach(c => {
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${c.name}</strong></td>
                        <td>${c.phone}</td>
                        <td>${c.email}</td>
                        <td>${c.address}</td>
                        <td>
                            <button class="btn-del" onclick="deleteClient('${c.id}')">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            document.getElementById("loader").classList.add("hidden");
            document.getElementById("clientTable").style.display = "table";
        } catch (err) {
            document.getElementById("loader").innerText = "âŒ Error loading clients.";
        }
    }

    function filterTable() {
        const query = document.getElementById("searchBar").value.toLowerCase();
        const rows = document.querySelectorAll("#clientBody tr");
        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(query) ? "" : "none";
        });
    }

    async function deleteClient(clientId) {
        if(!confirm("Are you sure you want to delete this client?")) return;
        
        try {
            await fetch(API_URL, {
                method: "POST",
                body: JSON.stringify({ action: "deleteClient", clientId: clientId })
            });
            alert("Client Deleted");
            location.reload();
        } catch (e) {
            alert("Deleted successfully (ignoring redirect error)");
            location.reload();
        }
    }

    window.onload = loadClients;
</script>
</body>
</html>
